<div class="grid">
    <div class="col-12 ">
        <div class="card ">
            <div class="text-center mb-5" style="padding-bottom: 1rem;">
                <div class="text-900 text-3xl font-medium mb-3">Gestion des Candidats</div>
                <span class="text-600 font-medium">Gérez vos candidats et suivez leur parcours de recrutement.</span>
            </div>

            

            <p-toast></p-toast>
            <p-confirmDialog [style]="{width: '460px'}"></p-confirmDialog>
            <div class="card ">
                <p-toolbar class="mb-2">
                    <ng-template pTemplate="left">
                        <div class="flex gap-2 items-center flex-wrap">
                        <button pButton pRipple label="Nouveau" icon="pi pi-plus" class="p-button-success" (click)="openNew()"></button>
                        <button pButton pRipple label="Supprimer" icon="pi pi-trash" class="p-button-danger"
                                (click)="deleteSelectedCandidates()" 
                                [disabled]="!selectedCandidates || !selectedCandidates.length">
                        </button>
                        </div>
                    </ng-template>

                    <ng-template pTemplate="center">
                        <div class="flex justify-center items-center w-full md:w-auto my-2 md:my-0">
                        <app-candidate-status-filter (statusChange)="dt.filter($event, 'status', 'in')" style="padding-top: 0.8rem;"></app-candidate-status-filter>
                        </div>
                    </ng-template>

                    <ng-template pTemplate="right">
                        <span class="p-input-icon-left w-full md:w-auto">
                            <input
                                pInputText
                                type="text"
                                [(ngModel)]="globalFilterValue"
                                (keydown.enter)="onGlobalFilter(dt, $event)"
                                placeholder="Rechercher..."
                            />
                        </span>

                    </ng-template>
                </p-toolbar>
                <div class="flex flex-column md:flex-row md:justify-content-between ">
                    <p-table 
                        #dt 
                        [value]="candidates" 
                        responsiveLayout="scroll"
                        [scrollable]="true"
                        scrollWidth="200px"
                        [rows]="10" 
                        [paginator]="true" 
                        [globalFilterFields]="['firstName', 'lastName', 'email', 'status']"
                        [(selection)]="selectedCandidates" 
                        [rowHover]="true" 
                        dataKey="id"
                        [loading]="loading"
                        [showCurrentPageReport]="true"
                        currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} candidats"
                        [rowsPerPageOptions]="[10, 25, 50]">
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 5rem">
                                    <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                                </th>
                                <th pSortableColumn="firstName" style="min-width:7rem">Prénom <p-sortIcon field="firstName"></p-sortIcon></th>
                                <th pSortableColumn="lastName" style="min-width:6rem">Nom <p-sortIcon field="lastName"></p-sortIcon></th>
                                <th pSortableColumn="email" style="min-width:10rem">Email <p-sortIcon field="email"></p-sortIcon></th>
                                <th pSortableColumn="skills">Compétences</th>
                                <th pSortableColumn="experience" style="min-width:8.2rem">Expérience <p-sortIcon field="experience"></p-sortIcon></th>
                                <th pSortableColumn="status">Statut <p-sortIcon field="status"></p-sortIcon></th>
                                <th pSortableColumn="rating">Évaluation <p-sortIcon field="rating"></p-sortIcon></th>
                                <th></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-candidate>
                            <tr>
                                <td>
                                    <p-tableCheckbox [value]="candidate"></p-tableCheckbox>
                                </td>
                                <td>{{ candidate.firstName }}</td>
                                <td>{{ candidate.lastName }}</td>
                                <td>{{ candidate.email }}</td>
                                <td>
                                    <div class="flex flex-wrap gap-1" *ngIf="candidate.skills">
                                        <p-tag *ngFor="let skill of candidate.skills.slice(0, 3)" [value]="skill" [rounded]="true"></p-tag>
                                        <p-tag *ngIf="candidate.skills.length > 3" [value]="'+' + (candidate.skills.length - 3)" severity="info" [rounded]="true"></p-tag>
                                    </div>
                                </td>
                                <td>{{ candidate.experience }} ans</td>
                                <td>
                                    <p-tag [value]="getStatusLabel(candidate.status || '')" [severity]="getSeverity(candidate.status || '')"></p-tag>
                                </td>
                                <td>
                                    <p-rating [ngModel]="candidate.rating" [readonly]="true" [cancel]="false"></p-rating>
                                </td>
                                <td>
                                    <div class="flex">
                                        <button pButton pRipple icon="pi pi-eye" class="p-button-rounded p-button-info mr-2" [routerLink]="['/pages/candidate', candidate.id]"></button>
                                        <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success mr-2" [routerLink]="['/pages/candidate', candidate.id, 'edit']"></button>
                                        <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-danger" (click)="deleteCandidate(candidate)"></button>
                                    </div>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="summary">
                            <div class="flex align-items-center justify-content-between">
                                Au total il y a {{ candidates ? candidates.length : 0 }} candidats.
                            </div>
                        </ng-template>
                    </p-table>
                </div>
            </div>

            <p-dialog [(visible)]="deleteCandidateDialog" header="Confirmation" [modal]="true" [style]="{ width: '450px' }">
                <div class="flex align-items-center justify-content-center">
                    <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem;padding-right: 0.5rem;"></i>
                    <span *ngIf="candidate">Êtes-vous sûr de vouloir supprimer <b>{{ candidate.firstName }} {{ candidate.lastName }}</b> ?</span>
                </div>
                <ng-template pTemplate="footer">
                    <button pButton pRipple icon="pi pi-times" class="p-button-text" label="Non" (click)="deleteCandidateDialog = false"></button>
                    <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Oui" (click)="confirmDelete()"></button>
                </ng-template>
            </p-dialog>

            <p-dialog [(visible)]="deleteCandidatesDialog" header="Confirmation" [modal]="true" [style]="{ width: '460px' }">
                <div class="flex align-items-center justify-content-center">
                    <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem;padding-right: 0.5rem;"></i>
                    <span>Êtes-vous sûr de vouloir supprimer les candidats sélectionnés ?</span>
                </div>
                <ng-template pTemplate="footer">
                    <button pButton pRipple icon="pi pi-times" class="p-button-text" label="Non" (click)="deleteCandidatesDialog = false"></button>
                    <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Oui" (click)="confirmDeleteSelected()"></button>
                </ng-template>
            </p-dialog>
        </div>
    </div>
</div>
